!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/forms"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-currency",["exports","@angular/core","@angular/forms","@angular/common"],t):t((e=e||self)["ngx-currency"]={},e.ng.core,e.ng.forms,e.ng.common)}(this,(function(e,t,n,i){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var r;function s(e,t,n,i){var r,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,n,o):r(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o}function o(e,t){return function(n,i){t(n,i,e)}}(r=e.CurrencyMaskInputMode||(e.CurrencyMaskInputMode={}))[r.FINANCIAL=0]="FINANCIAL",r[r.NATURAL=1]="NATURAL";var a=new t.InjectionToken("currency.mask.config"),u=function(){function e(e){this.htmlInputElement=e}return e.prototype.setCursorAt=function(e){if(this.htmlInputElement.setSelectionRange)this.htmlInputElement.focus(),this.htmlInputElement.setSelectionRange(e,e);else if(this.htmlInputElement.createTextRange){var t=this.htmlInputElement.createTextRange();t.collapse(!0),t.moveEnd("character",e),t.moveStart("character",e),t.select()}},e.prototype.updateValueAndCursor=function(e,t,n){this.rawValue=e,n-=t-e.length,this.setCursorAt(n)},Object.defineProperty(e.prototype,"canInputMoreNumbers",{get:function(){var e=!(this.rawValue.replace(/[^0-9\u0660-\u0669\u06F0-\u06F9]/g,"").length>=this.htmlInputElement.maxLength&&this.htmlInputElement.maxLength>=0),t=this.inputSelection.selectionStart,n=this.inputSelection.selectionEnd,i=!(t==n||!this.htmlInputElement.value.substring(t,n).match(/[^0-9\u0660-\u0669\u06F0-\u06F9]/)),r="0"==this.htmlInputElement.value.substring(0,1);return e||i||r},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSelection",{get:function(){var e=0,t=0;if("number"==typeof this.htmlInputElement.selectionStart&&"number"==typeof this.htmlInputElement.selectionEnd)e=this.htmlInputElement.selectionStart,t=this.htmlInputElement.selectionEnd;else{var n=document.selection.createRange();if(n&&n.parentElement()==this.htmlInputElement){var i=this.htmlInputElement.value.length,r=this.htmlInputElement.value.replace(/\r\n/g,"\n"),s=this.htmlInputElement.createTextRange();s.moveToBookmark(n.getBookmark());var o=this.htmlInputElement.createTextRange();o.collapse(!1),s.compareEndPoints("StartToEnd",o)>-1?e=t=i:(e=-s.moveStart("character",-i),e+=r.slice(0,e).split("\n").length-1,s.compareEndPoints("EndToEnd",o)>-1?t=i:(t=-s.moveEnd("character",-i),t+=r.slice(0,t).split("\n").length-1))}}return{selectionStart:e,selectionEnd:t}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rawValue",{get:function(){return this.htmlInputElement&&this.htmlInputElement.value},set:function(e){this._storedRawValue=e,this.htmlInputElement&&(this.htmlInputElement.value=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storedRawValue",{get:function(){return this._storedRawValue},enumerable:!0,configurable:!0}),e}(),l=function(){function t(e,t){this.htmlInputElement=e,this.options=t,this.SINGLE_DIGIT_REGEX=new RegExp(/^[0-9\u0660-\u0669\u06F0-\u06F9]$/),this.ONLY_NUMBERS_REGEX=new RegExp(/[^0-9\u0660-\u0669\u06F0-\u06F9]/g),this.PER_AR_NUMBER=new Map,this.inputManager=new u(e),this.initialize()}return t.prototype.initialize=function(){this.PER_AR_NUMBER.set("۰","0"),this.PER_AR_NUMBER.set("۱","1"),this.PER_AR_NUMBER.set("۲","2"),this.PER_AR_NUMBER.set("۳","3"),this.PER_AR_NUMBER.set("۴","4"),this.PER_AR_NUMBER.set("۵","5"),this.PER_AR_NUMBER.set("۶","6"),this.PER_AR_NUMBER.set("۷","7"),this.PER_AR_NUMBER.set("۸","8"),this.PER_AR_NUMBER.set("۹","9"),this.PER_AR_NUMBER.set("٠","0"),this.PER_AR_NUMBER.set("١","1"),this.PER_AR_NUMBER.set("٢","2"),this.PER_AR_NUMBER.set("٣","3"),this.PER_AR_NUMBER.set("٤","4"),this.PER_AR_NUMBER.set("٥","5"),this.PER_AR_NUMBER.set("٦","6"),this.PER_AR_NUMBER.set("٧","7"),this.PER_AR_NUMBER.set("٨","8"),this.PER_AR_NUMBER.set("٩","9")},t.prototype.addNumber=function(t){var n=this.options,i=n.decimal,r=n.precision,s=n.inputMode,o=String.fromCharCode(t),a=o===this.options.decimal;if(this.rawValue){f=this.inputSelection.selectionStart;var u=this.inputSelection.selectionEnd,l=this.rawValue.substring(0,f),h=this.rawValue.substring(u,this.rawValue.length),p=-1!==l.indexOf(i);s===e.CurrencyMaskInputMode.NATURAL&&p&&f===u&&(h=h.substring(1));var c=l+o+h,d=f+1;if((a||o===this.options.thousands)&&o===h[0])d++;else if(!this.SINGLE_DIGIT_REGEX.test(o))return;this.rawValue=c,this.updateFieldValue(d)}else{this.rawValue=this.applyMask(!1,o);var f=void 0;s===e.CurrencyMaskInputMode.NATURAL&&r>0&&(f=this.rawValue.indexOf(i),a&&f++),this.updateFieldValue(f)}},t.prototype.applyMask=function(t,n,i){void 0===i&&(i=!1);var r=this.options,s=r.allowNegative,o=r.decimal,a=r.precision,u=r.prefix,l=r.suffix,h=r.thousands,p=r.min,c=r.max,d=r.inputMode,f=(n=t?new Number(n).toFixed(a):n).replace(this.ONLY_NUMBERS_REGEX,"");if(!f&&n!==o)return"";d!==e.CurrencyMaskInputMode.NATURAL||t||i||(f=(n=this.padOrTrimPrecision(n)).replace(this.ONLY_NUMBERS_REGEX,""));var g=f.slice(0,f.length-a).replace(/^\u0660*/g,"").replace(/^\u06F0*/g,"").replace(/^0*/g,"");""==g&&(g="0");var m=parseInt(g);g=g.replace(/\B(?=([0-9\u0660-\u0669\u06F0-\u06F9]{3})+(?![0-9\u0660-\u0669\u06F0-\u06F9]))/g,h),h&&g.startsWith(h)&&(g=g.substring(1));var v=g,y=f.slice(f.length-a),R=parseInt(y)||0,E=n.indexOf("-")>-1;c=this.isNullOrUndefined(c)||this.isNullOrUndefined(p)?c:Math.max(c,p);var M=m+R/100;return M=E?-M:M,!this.isNullOrUndefined(c)&&M>c?this.applyMask(!0,c+""):!this.isNullOrUndefined(p)&&M<p?this.applyMask(!0,p+""):(a>0&&("0"==v&&y.length<a?v+=o+"0".repeat(a-1)+y:v+=o+y),(E&&s&&!(0==M)?"-":"")+u+v+l)},t.prototype.padOrTrimPrecision=function(e){var t=this.options,n=t.decimal,i=t.precision,r=e.lastIndexOf(n);-1===r&&(r=e.length,e+=n);var s=e.substring(r).replace(this.ONLY_NUMBERS_REGEX,""),o=s.length;if(o<i)for(var a=o;a<i;a++)s+="0";else o>i&&(s=s.substring(0,s.length+i-o));return e.substring(0,r)+n+s},t.prototype.clearMask=function(e){if(this.isNullable()&&""===e)return null;var t=(e||"0").replace(this.options.prefix,"").replace(this.options.suffix,"");return this.options.thousands&&(t=t.replace(new RegExp("\\"+this.options.thousands,"g"),"")),this.options.decimal&&(t=t.replace(this.options.decimal,".")),this.PER_AR_NUMBER.forEach((function(e,n){var i=new RegExp(n,"g");t=t.replace(i,e)})),parseFloat(t)},t.prototype.changeToNegative=function(){this.options.allowNegative&&""!=this.rawValue&&"-"!=this.rawValue.charAt(0)&&0!=this.value&&(this.rawValue=this.applyMask(!1,"-"+this.rawValue))},t.prototype.changeToPositive=function(){this.rawValue=this.applyMask(!1,this.rawValue.replace("-",""))},t.prototype.removeNumber=function(t){var n=this.options,i=n.decimal,r=n.thousands,s=n.prefix,o=n.suffix,a=n.inputMode;if(this.isNullable()&&0==this.value)this.rawValue=null;else{var u=this.inputSelection.selectionEnd,l=this.inputSelection.selectionStart,h=this.rawValue.length-o.length;if(u=Math.min(h,Math.max(u,s.length)),(l=Math.min(h,Math.max(l,s.length)))!==u||this.inputSelection.selectionStart===this.inputSelection.selectionEnd){var p=this.rawValue.indexOf(i);-1===p&&(p=this.rawValue.length);var c=0,d="";if(u===l)if(8==t){if(l<=s.length)return;l--,this.rawValue.substr(l,1).match(/\d/)||l--,a===e.CurrencyMaskInputMode.NATURAL&&p<u&&(c=-1)}else if(46==t||63272==t){if(l===h)return;u++,this.rawValue.substr(l,1).match(/\d/)||(l++,u++)}if(a===e.CurrencyMaskInputMode.NATURAL&&l>p)for(var f=u-l,g=0;g<f;g++)d+="0";var m=this.rawValue.length-u;this.rawValue=this.rawValue.substring(0,l)+d+this.rawValue.substring(u),this.rawValue.substr(s.length,1)===r&&(this.rawValue=this.rawValue.substring(0,s.length)+this.rawValue.substring(s.length+1),m=Math.min(m,this.rawValue.length-s.length)),this.updateFieldValue(this.rawValue.length-m+c,!0)}else this.updateFieldValue(l)}},t.prototype.updateFieldValue=function(e,t){void 0===t&&(t=!1);var n=this.applyMask(!1,this.rawValue||"",t);e=null==e?this.rawValue.length:e,e=Math.max(this.options.prefix.length,Math.min(e,this.rawValue.length-this.options.suffix.length)),this.inputManager.updateValueAndCursor(n,this.rawValue.length,e)},t.prototype.updateOptions=function(e){var t=this.value;this.options=e,this.value=t},t.prototype.prefixLength=function(){return this.options.prefix.length},t.prototype.suffixLength=function(){return this.options.suffix.length},t.prototype.isNullable=function(){return this.options.nullable},Object.defineProperty(t.prototype,"canInputMoreNumbers",{get:function(){return this.inputManager.canInputMoreNumbers},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSelection",{get:function(){return this.inputManager.inputSelection},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rawValue",{get:function(){return this.inputManager.rawValue},set:function(e){this.inputManager.rawValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storedRawValue",{get:function(){return this.inputManager.storedRawValue},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.clearMask(this.rawValue)},set:function(e){this.rawValue=this.applyMask(!0,""+e)},enumerable:!0,configurable:!0}),t.prototype.isNullOrUndefined=function(e){return null==e},t}(),h=function(){function e(e,t){this.inputService=new l(e,t)}return e.prototype.handleCut=function(e){var t=this;setTimeout((function(){t.inputService.updateFieldValue(),t.setValue(t.inputService.value),t.onModelChange(t.inputService.value)}),0)},e.prototype.handleInput=function(e){var t=this.inputService.rawValue.charCodeAt(this.inputService.rawValue.length-1),n=this.inputService.rawValue.length,i=this.inputService.inputSelection.selectionEnd,r=this.inputService.storedRawValue.length;if(this.inputService.rawValue=this.inputService.storedRawValue,n==i&&1==Math.abs(n-r)){if(n<r&&this.inputService.removeNumber(8),n>r)switch(t){case 43:this.inputService.changeToPositive();break;case 45:this.inputService.changeToNegative();break;default:if(!this.inputService.canInputMoreNumbers)return;this.inputService.addNumber(t)}this.setCursorPosition(e),this.onModelChange(this.inputService.value)}else this.setCursorPosition(e)},e.prototype.handleKeydown=function(e){var t=e.which||e.charCode||e.keyCode;8!=t&&46!=t&&63272!=t||(e.preventDefault(),this.inputService.inputSelection.selectionStart<=this.inputService.prefixLength()&&this.inputService.inputSelection.selectionEnd>=this.inputService.rawValue.length-this.inputService.suffixLength()?this.clearValue():(this.inputService.removeNumber(t),this.onModelChange(this.inputService.value)))},e.prototype.clearValue=function(){this.setValue(this.inputService.isNullable()?null:0),this.onModelChange(this.inputService.value)},e.prototype.handleKeypress=function(e){var t=e.which||e.charCode||e.keyCode;if(e.preventDefault(),97!==t||!e.ctrlKey){switch(t){case void 0:case 9:case 13:return;case 43:this.inputService.changeToPositive();break;case 45:this.inputService.changeToNegative();break;default:if(this.inputService.canInputMoreNumbers)Math.abs(this.inputService.inputSelection.selectionEnd-this.inputService.inputSelection.selectionStart)==this.inputService.rawValue.length&&this.setValue(null),this.inputService.addNumber(t)}this.onModelChange(this.inputService.value)}},e.prototype.handlePaste=function(e){var t=this;setTimeout((function(){t.inputService.updateFieldValue(),t.setValue(t.inputService.value),t.onModelChange(t.inputService.value)}),1)},e.prototype.updateOptions=function(e){this.inputService.updateOptions(e)},e.prototype.getOnModelChange=function(){return this.onModelChange},e.prototype.setOnModelChange=function(e){this.onModelChange=e},e.prototype.getOnModelTouched=function(){return this.onModelTouched},e.prototype.setOnModelTouched=function(e){this.onModelTouched=e},e.prototype.setValue=function(e){this.inputService.value=e},e.prototype.setCursorPosition=function(e){setTimeout((function(){e.target.setSelectionRange(e.target.value.length,e.target.value.length)}),0)},e}(),p={provide:n.NG_VALUE_ACCESSOR,useExisting:t.forwardRef((function(){return c})),multi:!0},c=function(){function n(t,n,i){this.currencyMaskConfig=t,this.elementRef=n,this.keyValueDiffers=i,this.options={},this.optionsTemplate={align:"right",allowNegative:!0,allowZero:!0,decimal:".",precision:2,prefix:"$ ",suffix:"",thousands:",",nullable:!1,inputMode:e.CurrencyMaskInputMode.FINANCIAL},t&&(this.optionsTemplate=t),this.keyValueDiffer=i.find({}).create()}return n.prototype.ngAfterViewInit=function(){this.elementRef.nativeElement.style.textAlign=this.options&&this.options.align?this.options.align:this.optionsTemplate.align},n.prototype.ngDoCheck=function(){this.keyValueDiffer.diff(this.options)&&(this.elementRef.nativeElement.style.textAlign=this.options.align?this.options.align:this.optionsTemplate.align,this.inputHandler.updateOptions(Object.assign({},this.optionsTemplate,this.options)))},n.prototype.ngOnInit=function(){this.inputHandler=new h(this.elementRef.nativeElement,Object.assign({},this.optionsTemplate,this.options))},n.prototype.handleBlur=function(e){this.inputHandler.getOnModelTouched().apply(e)},n.prototype.handleCut=function(e){this.isChromeAndroid()||!this.isReadOnly()&&this.inputHandler.handleCut(e)},n.prototype.handleInput=function(e){this.isChromeAndroid()&&!this.isReadOnly()&&this.inputHandler.handleInput(e)},n.prototype.handleKeydown=function(e){this.isChromeAndroid()||!this.isReadOnly()&&this.inputHandler.handleKeydown(e)},n.prototype.handleKeypress=function(e){this.isChromeAndroid()||!this.isReadOnly()&&this.inputHandler.handleKeypress(e)},n.prototype.handlePaste=function(e){this.isChromeAndroid()||!this.isReadOnly()&&this.inputHandler.handlePaste(e)},n.prototype.handleDrop=function(e){this.isChromeAndroid()||e.preventDefault()},n.prototype.isChromeAndroid=function(){return/chrome/i.test(navigator.userAgent)&&/android/i.test(navigator.userAgent)},n.prototype.isReadOnly=function(){return this.elementRef.nativeElement.hasAttribute("readonly")},n.prototype.registerOnChange=function(e){this.inputHandler.setOnModelChange(e)},n.prototype.registerOnTouched=function(e){this.inputHandler.setOnModelTouched(e)},n.prototype.setDisabledState=function(e){this.elementRef.nativeElement.disabled=e},n.prototype.writeValue=function(e){this.inputHandler.setValue(e)},n.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[a]}]},{type:t.ElementRef},{type:t.KeyValueDiffers}]},s([t.Input()],n.prototype,"options",void 0),s([t.HostListener("blur",["$event"])],n.prototype,"handleBlur",null),s([t.HostListener("cut",["$event"])],n.prototype,"handleCut",null),s([t.HostListener("input",["$event"])],n.prototype,"handleInput",null),s([t.HostListener("keydown",["$event"])],n.prototype,"handleKeydown",null),s([t.HostListener("keypress",["$event"])],n.prototype,"handleKeypress",null),s([t.HostListener("paste",["$event"])],n.prototype,"handlePaste",null),s([t.HostListener("drop",["$event"])],n.prototype,"handleDrop",null),n=s([t.Directive({selector:"[currencyMask]",providers:[p]}),o(0,t.Optional()),o(0,t.Inject(a))],n)}(),d=function(){function e(){}var r;return r=e,e.forRoot=function(e){return{ngModule:r,providers:[{provide:a,useValue:e}]}},e=r=s([t.NgModule({imports:[i.CommonModule,n.FormsModule],declarations:[c],exports:[c]})],e)}();e.CURRENCYMASKDIRECTIVE_VALUE_ACCESSOR=p,e.CurrencyMaskDirective=c,e.NgxCurrencyModule=d,e.ɵa=a,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-currency.umd.min.js.map